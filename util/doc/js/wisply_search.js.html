<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: wisply/search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: wisply/search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global $, wisply, Handlebars, Bloodhound */
var searchModule = {};
/**
 * @file Encapsulates the functionality for a search
 * @author Cristian Sima
 */
/**
 * Encapsulates the functionality for search
 * @namespace SearchModule
 */
var SearchModule = function() {
	'use strict';
	// register a new function for the JavaScript template library
	Handlebars.registerHelper('cutString', function(theString, numberOfAllowedCharacters) {
		if (theString.length > numberOfAllowedCharacters) {
			var shortString = theString.substr(0, numberOfAllowedCharacters);
			theString = shortString + "...";
		}
		return new Handlebars.SafeString(theString);
	});
	/**
	 * Does nothing
	 * @memberof Field
	 * @class Wikier
	 * @param [string] select The selector for the search
	 * @classdesc It gets the elements
	 */
	var Field = function Field(selector) {
		var instance = this,
			engine = new Bloodhound({
			datumTokenizer: function(d) {
		     return Bloodhound.tokenizers.whitespace(d.Title);
		 },
			queryTokenizer: Bloodhound.tokenizers.whitespace,
			identify: function(o) {
				return o.ID;
			},
			remote: {
        cacheKey: 'ID',
				url: '/api/search/anything/%QUERY',
				wildcard: '%QUERY',
				rateLimitWait: 600,
			}
		});

		$(selector).val(this.getLastSearchValue());

			var suggestion = [
					"&lt;div style='width:100%'>&lt;div class='row'>",
					"&lt;div class='col-lg-1 col-md-1 col-sm-1 col-xs-1 text-center' style='min-width:40px;'>",
					"&lt;div style='width:40px' class='text-center'>&lt;img class='search-logo thumbnail' style='margin-bottom:0px' src='{{Icon}}' />&lt;/div>",
					"&lt;/div>",
					"&lt;div class='col-lg-10 col-md-10 col-sm-10 col-xs-10 search-result'>",
					"&lt;span class='search-title'>{{ cutString Title 40 }}&lt;/span>&lt;br />",
					"&lt;span class='text-muted bold search-category'>&lt;small>{{ Category }}&lt;/small>&lt;/span>&lt;br />&lt;span class='text-muted search-description'>{{ cutString Description 110 }}&lt;/span>&lt;/div>",
				"&lt;/div>&lt;/div>",
			].join("\n");

			var footer = [
					"&lt;div class='row'>&lt;div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>",
					'&lt;div class="search-footer">',
					"&lt;span>&lt;span class='text-primary'>&lt;span class='glyphicon glyphicon-search'>&lt;/span>&lt;/span> &amp;nbsp;&amp;nbsp;Find more about&lt;strong> {{cutString query 30 }}",
					"&lt;/strong>&lt;/div>",
					"&lt;/div>&lt;/div>"
				].join("\n");


			var resultEngine = {
					name: 'Title',
					display: "Title",
					valueKey: "Title",
					source: function(q, sync, async) {
							if(q !== "") {
							engine.search(q, sync, async);
						}
					},
					limit: 7,
					templates: {
						footer: Handlebars.compile(footer),
						empty: [
						        '&lt;div class="search-no-results">',
						          '&lt;span class="glyphicon glyphicon-inbox">&lt;/span> No results available.',
						        '&lt;/div>'
						      ].join('\n'),
						suggestion: Handlebars.compile(suggestion),
					}
			};

			var cookieEngine = {
				templates: {
					header: "&lt;div class='search-header'>Last searches&lt;/div>",
				},
				source : function() {
					var instanceCopy = instance;
					return (function cookieEngine(q, sync, async) {
						if (q === '') {
							var searches = instanceCopy.getLastSearchQueries();
							sync(instanceCopy.getLastSearchQueries());
						}
					});
				}(),
			};

		this.object = $(selector).typeahead({
			hint: true,
			highlight: false,
			minLength: 0,
		}, resultEngine, cookieEngine);

		// keep the code cosistent even if we do not use the event
		/* jshint unused:false */
		this.object.bind('typeahead:select', function(event, suggestion) {
			if(suggestion.Category) {
				instance.saveSearchQuery(suggestion.Title);
				window.location = suggestion.URL;
			} else {
				var t = this,
					suggestionCopy = suggestion;
				$(this).typeahead('close');
				setTimeout(function() {
					$(t).typeahead("val", "");
					$(t).typeahead("val", suggestionCopy);
					$(t).typeahead('open');
				}, 100);
			}
		});
		this.object.bind("typeahead:active", function() {
			var defaultSearchWidth = 400,
				width = parseInt($(window).width(), 10),
				searchWidth = defaultSearchWidth;
			if (width &lt; searchWidth) {
				searchWidth = width * 9.95 / 10;
			}
			$(".tt-menu").css({
				"width": searchWidth - 30,
			});
		});
		this.object.bind("typeahead:idle", function() {
			var smallSearch = $("#search-small-input"),
				button = $("#show-small-search-button");
			$("#search-small").hide();
			$("#full-logo").show();
			button.html("&lt;span class='glyphicon glyphicon-search'>&lt;/span>");
			wisply.isSmallSearchDisplayed = !wisply.isSmallSearchDisplayed;
		});
		this.cookieName = 'last-searches';
	};
	Field.prototype =
		/** @lends SearchModule.Field */
		{
			saveSearchQuery: function(newValue) {
				var oldList,
				allowedSearches = 5,
				newList;
				oldList = this.getLastSearchQueries();

				if(!oldList) {
					newList = [];
				} else {
					newList = oldList;
					if(newValue &amp;&amp; newValue !== "") {
						// if the same as last one
						if(newValue !== oldList[0]) {
							newList.unshift(newValue);
						}
					}
					if (newList.length > allowedSearches) {
						newList.pop();
					}
				}
				$.cookie(this.cookieName, newList, { path: '/' });
			},
			getLastSearchValue: function() {
				var listOfSearches = this.getLastSearchQueries()["last-searches"],
					last;
				if(!listOfSearches) {
					return "";
				}
				last = listOfSearches[0];
				if(!last) {
					return "";
				}
				return last;
			},
			getLastSearchQueries: function () {
				return $.cookie(this.cookieName);
			}
		};
	return {
		Field: Field,
	};
};
$(document).ready(function() {
	"use strict";
	searchModule = new SearchModule();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Accounts.Account.html">Account</a></li><li><a href="Accounts.Manager.html">Manager</a></li><li><a href="Administration.Admin.html">Admin</a></li><li><a href="APITableList.Manager.html">Manager</a></li><li><a href="APITableList.Table.html">Table</a></li><li><a href="Connection.Connection.html">Connection</a></li><li><a href="Field.Wikier.html">Wikier</a></li><li><a href="FunctionalityInstitution.Manager.html">Manager</a></li><li><a href="Harvest.HarvestConnection.html">HarvestConnection</a></li><li><a href="Harvest.History.html">History</a></li><li><a href="Harvest.StageManager.html">StageManager</a></li><li><a href="HarvestList.DecisionManager.html">DecisionManager</a></li><li><a href="HarvestList.GUI.html">GUI</a></li><li><a href="HarvestProcess.DecisionManager.html">DecisionManager</a></li><li><a href="HarvestProcess.Indicator.html">Indicator</a></li><li><a href="HarvestProcess.StageGUI.html">StageGUI</a></li><li><a href="HarvestProcess.WisplyCounter.html">WisplyCounter</a></li><li><a href="Institutions.GUI.html">GUI</a></li><li><a href="Institutions.Institution.html">Institution</a></li><li><a href="Institutions.Manager.html">Manager</a></li><li><a href="Log.Manager.html">Manager</a></li><li><a href="Login.Form.html">Form</a></li><li><a href="Operations.Manager.html">Manager</a></li><li><a href="Processes.Manager.html">Manager</a></li><li><a href="PublicRepository.BottomGUI.html">BottomGUI</a></li><li><a href="PublicRepository.Manager.html">Manager</a></li><li><a href="PublicRepository.SideGUI.html">SideGUI</a></li><li><a href="PublicRepository.TopGUI.html">TopGUI</a></li><li><a href="Register.Form.html">Form</a></li><li><a href="Repositories.GUI.html">GUI</a></li><li><a href="Repositories.Manager.html">Manager</a></li><li><a href="Repositories.Repository.html">Repository</a></li><li><a href="TyperModule.Typer.html">Typer</a></li><li><a href="Websockets.Connection.html">Connection</a></li><li><a href="Websockets.Gui.html">Gui</a></li><li><a href="WikierModule.Wikier.html">Wikier</a></li><li><a href="Wisply.App.html">App</a></li><li><a href="Wisply.Message.html">Message</a></li><li><a href="Wisply.ShortcutManager.html">ShortcutManager</a></li></ul><h3>Events</h3><ul><li><a href="Connection.html#event:FireLogoutUser">FireLogoutUser</a></li></ul><h3>Namespaces</h3><ul><li><a href="Accounts.html">Accounts</a></li><li><a href="Administration.html">Administration</a></li><li><a href="APITableList.html">APITableList</a></li><li><a href="Connection.html">Connection</a></li><li><a href="FunctionalityInstitution.html">FunctionalityInstitution</a></li><li><a href="Harvest.html">Harvest</a></li><li><a href="HarvestList%25250DIt%252520holds%252520the%252520functionality%252520to%252520see%252520a%252520live%252520list%252520of%252520repositories.html">HarvestListIt holds the functionality to see a live list of repositories</a></li><li><a href="HarvestProcess.html">HarvestProcess</a></li><li><a href="Institutions.html">Institutions</a></li><li><a href="Log.html">Log</a></li><li><a href="Login.html">Login</a></li><li><a href="Operations.html">Operations</a></li><li><a href="Processes.html">Processes</a></li><li><a href="PublicRepository.html">PublicRepository</a></li><li><a href="Register.html">Register</a></li><li><a href="Repositories.html">Repositories</a></li><li><a href="SearchModule.html">SearchModule</a></li><li><a href="TyperModule.html">TyperModule</a></li><li><a href="Websockets.html">Websockets</a></li><li><a href="WikierModule.html">WikierModule</a></li><li><a href="Wisply.html">Wisply</a></li></ul><h3>Global</h3><ul><li><a href="global.html#analyse">analyse</a></li><li><a href="global.html#changeURL">changeURL</a></li><li><a href="global.html#disableModifyURL">disableModifyURL</a></li><li><a href="global.html#enableModifyURL">enableModifyURL</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#getCounter">getCounter</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initExistingProcess">initExistingProcess</a></li><li><a href="global.html#initNewProcess">initNewProcess</a></li><li><a href="global.html#paint">paint</a></li><li><a href="global.html#perform">perform</a></li><li><a href="global.html#setCurrentCounter">setCurrentCounter</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#wisply">wisply</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Fri Oct 23 2015 12:53:05 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
