<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/repository.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/repository.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global $, wisply, server */
/**
 * @file Encapsulates the functionality for displaying the contents of a repository for the public
 * @author Cristian Sima
 */
/**
 * @namespace PublicRepository
 */
var PublicRepository = function() {
	'use strict';
	/**
	 * The constructor sets the default values
	 * @memberof PublicRepository
	 * @class Manager
	 * @classdesc It encapsulets the functionality for the public repository
	 * @param {object} currentRepository Represents the current repository
	 */
	var Manager = function Manager(currentRepository) {
		this.repository = currentRepository;
		this.min = 0;
		this.resourcePerPage = 15;
		// They are used to extract the verbs and parameters from the hash
		this.delimitator = {
			verb: "*",
			parameter: "-",
			insideVerb: "|",
		};
	};
	Manager.prototype =
		/** @lends PublicRepository.Manager */
		{
			/**
			 * It activates the listeners and adds the shortcuts
			 */
			init: function() {
				var instance = this;

				function initHash() {
					$(window).on('hashchange', function() {
						instance.hashChanged();
					});
				}
				/**
				 * It adds the keys' shortcuts
				 */
				function initKeys() {
					var shortcuts = [{
						"type": "keyup",
						"key": "Ctrl+left",
						"callback": function() {
							wisply.publicRepositoryModule.manager.showPrevious();
						}
					}, {
						"type": "keyup",
						"key": "Ctrl+right",
						"callback": function() {
							wisply.publicRepositoryModule.manager.showNext();
						}
					}];
					wisply.shortcutManager.activate(shortcuts);
				}
				initHash();
				initKeys();
        this.hashChanged();
			},
			/**
			 * It loads the resources from server according to the current settings
			 */
			getResources: function() {
				var instance = this;
				this.showLoading();
				$.ajax({
					url: "/api/repository/resources/" + this.repository.id + "/get/" + this.min + "/" + this.resourcePerPage,
					success: function(html) {
						instance.fired_NewResources(html);
					}
				});
			},
			/**
			 * It shows the wisply loading button
			 */
			showLoading: function() {
				$("#repository-resources").html('&lt;div class="text-center">' + wisply.getLoadingImage("medium") + '&lt;/div>');
			},
			/**
			 * Is is called when resources has came from the server. It shows them, activate the listeners and update the GUI
			 * @param  {string} html The HTML from server
			 */
			fired_NewResources: function(html) {
				this.changeResources(html);
				this.activateListeners();
				this.updateGUI();
			},
			/**
			 * It activates the listenrs for the next and previous buttons
			 */
			activateListeners: function() {
				var instance = this;
				/**
				 * It sets the listenes for next and previous buttons. In case they have a disabled attribute, it does not call their listeners
				 */
				function initButtons() {
					$(".next").click(function(event) {
						event.preventDefault();
						if (!$(this).hasClass("disabled")) {
							instance.showNext();
						}
					});
					$(".previous").click(function(event) {
						event.preventDefault();
						if (!$(this).hasClass("disabled")) {
							instance.showPrevious();
						}
					});
				}
				initButtons();
			},
			/**
			 * It shows the next resources
			 * @param  {event} event The event which has been generated when the button has been clicked
			 */
			showNext: function() {
				var newMin;
				newMin = parseInt(this.min, 10) + this.resourcePerPage;
				this.changeMin(newMin);
				this.goUp();
				this.updateHash();
			},
			/**
			 * It gets the previous resources
			 */
			showPrevious: function() {
				var newMin;
				newMin = parseInt(this.min, 10) - this.resourcePerPage;
				this.changeMin(newMin);
				this.goUp();
				this.updateHash();
			},
			/**
			 * It changes the min value (The value from which the resources are displayed)
			 * @param  {string} newValue The new value
			 */
			changeMin: function(newValue) {
				var value = 0;
				if ((!isInt(newValue)) || !newValue || newValue === "" || parseInt(newValue, 10) &lt; 0) {
					value = 0;
				} else {
					value = newValue;
				}
				this.min = parseInt(value, 10);
			},
			/**
			 * It updates the hash of the page
			 */
			updateHash: function() {
				var instance = this;
				/**
				 * It returns the string for the "list" verb
				 * @return {string} The string for the "list" verb
				 */
				function getList() {
					return "list" + instance.delimitator.insideVerb + instance.min + instance.delimitator.parameter + instance.resourcePerPage;
				}
				/**
				 * It returns a string which holds all the verbs
				 * @return {string} All the verbs as a string
				 */
				function getVerbs() {
					var verbs = [];
					verbs.push(getList());
					return verbs.join(instance.delimitator.verb);
				}
				window.location.hash = getVerbs();
			},
			/**
			 * It is called when the hash of the page has been changed. It gets all the verbs from the hash and updates the page
			 */
			hashChanged: function() {
				var h = window.location.hash,
					hash = h.substr(h.indexOf('#') + 1),
					instance = this;
				/**
				 * It extracts the verbs from a string and stores them inside this.verbs variable
				 * @param  {string} URL The entire string
				 */
				function extractVerbs(URL) {
					var ret = [],
						verbs = URL.split(instance.delimitator.verb);
					var i, verb, extracted;
					for (i = 0; i &lt; verbs.length; i++) {
						verb = verbs[i];
						extracted = extractElements(verb);
						ret.push(extracted);
					}
					return ret;
				}
				/**
				 * It extracts the elements of a verb and its name and returns them
				 * @param  {string} URLString The string which contains the verb
				 * @return {object} An object which holds the name of the verb and its paramters
				 */
				function extractElements(URLString) {
					var elements = {},
						el;
					el = URLString.split(instance.delimitator.insideVerb);
					elements.verb = el[0];
					if (el[1]) {
						elements.parameters = el[1].split(instance.delimitator.parameter);
					}
					return elements;
				}
				this.verbs = extractVerbs(hash);
				this.updateListVerb();
				this.getResources();
			},
			/**
			 * It returns a verb from the list of verbs
			 * @param  {string} name The name of the verb
			 */
			getVerb: function(name) {
				var verb,
					instance = this,
					verbs = instance.verbs;
				for (verb in verbs) {
					if (verbs.hasOwnProperty(verb)) {
						if (verbs[verb].verb === name) {
							return verbs[verb];
						}
					}
				}
			},
			/**
			 * It updates the "list" verb
			 */
			updateListVerb: function() {
				var verb = this.getVerb("list");
				if (verb) {
					this.changeMin(verb.parameters[0]);
					this.changeResourcesPerPage(verb.parameters[1]);
				}
			},
			/**
			 * It changes the number of resources displayed per page
			 * @param  {number} newValue The new value
			 */
			changeResourcesPerPage: function(newValue) {
				this.resourcePerPage = parseInt(newValue, 10);
			},
			/**
			 * It updates the next and previous buttons
			 */
			updateGUI: function() {
				var instance = this;
				/**
				 * If there are no more resources, it disables the previous button. Otherwise, it enables it
				 */
				function updatePreviousButton() {
					if (instance.min &lt; instance.resourcePerPage) {
						$(".previous").addClass("disabled");
					} else {
						$(".previous").removeClass("disabled");
					}
				}
				/**
				 * If there are no more resources, it disables the next button. Otherwise, it enables it
				 */
				function updateNextButton() {
					if (instance.min + instance.resourcePerPage >= parseInt(instance.repository.totalRecords, 10)) {
						$(".next").addClass("disabled");
					} else {
						$(".next").removeClass("disabled");
					}
				}

				function updateButtons() {
					updatePreviousButton();
					updateNextButton();
				}
				updateButtons();
			},
			/**
			 * It takes the user up to the list of resources
			 */
			goUp: function() {
				var listPosition = parseInt($("#repository-before-resources").offset().top, 10) - 70;
				$('html, body').animate({
					scrollTop: listPosition,
				}, 100);
			},
			/**
			 * It changes the content of the DIV which holds the list of resources
			 * @param  {string} html The new HTML code for the DIV
			 */
			changeResources: function(html) {
				$("#repository-resources").html(html);
			},
			/**
			 * It changes the content of the UP DIV which holds the options
			 * @param  {string} html The new HTML code for the DIV
			 */
			updateTop: function(html) {
				$("#repository-top").html(html);
			},
			/**
			 * It changes the content of the BOTTOM DIV which holds the options
			 * @param  {string} html The new HTML code for the DIV
			 */
			updateBottom: function(html) {
				$("#repository-bottom").html(html);
			}
		};
	/**
	 * It checks if a string is int
	 * @param  {string}  value The value of the string
	 * @return {Boolean} True if the string is an int, false otherwise
	 */
	function isInt(value) {
		return !isNaN(value) &amp;&amp; parseInt(Number(value)) == value &amp;&amp; !isNaN(parseInt(value, 10));
	}
	return {
		Manager: Manager
	};
};
$(document).ready(function() {
	"use strict";
	var module = new PublicRepository();
	wisply.publicRepositoryModule = module;
	wisply.publicRepositoryModule.manager = new module.Manager(server.repository);
	wisply.publicRepositoryModule.manager.init();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Accounts.Account.html">Account</a></li><li><a href="Accounts.Manager.html">Manager</a></li><li><a href="Administration.Admin.html">Admin</a></li><li><a href="Connection.Connection.html">Connection</a></li><li><a href="FunctionalityInstitution.Manager.html">Manager</a></li><li><a href="Harvest.HarvestConnection.html">HarvestConnection</a></li><li><a href="Harvest.History.html">History</a></li><li><a href="Harvest.StageManager.html">StageManager</a></li><li><a href="HarvestList.DecisionManager.html">DecisionManager</a></li><li><a href="HarvestList.GUI.html">GUI</a></li><li><a href="HarvestProcess.DecisionManager.html">DecisionManager</a></li><li><a href="HarvestProcess.Indicator.html">Indicator</a></li><li><a href="HarvestProcess.StageGUI.html">StageGUI</a></li><li><a href="HarvestProcess.WisplyCounter.html">WisplyCounter</a></li><li><a href="Institutions.GUI.html">GUI</a></li><li><a href="Institutions.Institution.html">Institution</a></li><li><a href="Institutions.Manager.html">Manager</a></li><li><a href="Log.Manager.html">Manager</a></li><li><a href="Login.Form.html">Form</a></li><li><a href="Operations.Manager.html">Manager</a></li><li><a href="Processes.Manager.html">Manager</a></li><li><a href="PublicRepository.Manager.html">Manager</a></li><li><a href="Register.Form.html">Form</a></li><li><a href="Repositories.GUI.html">GUI</a></li><li><a href="Repositories.Manager.html">Manager</a></li><li><a href="Repositories.Repository.html">Repository</a></li><li><a href="TyperModule.Typer.html">Typer</a></li><li><a href="Websockets.Connection.html">Connection</a></li><li><a href="Websockets.Gui.html">Gui</a></li><li><a href="WikierModule.Wikier.html">Wikier</a></li><li><a href="Wisply.App.html">App</a></li><li><a href="Wisply.Message.html">Message</a></li><li><a href="Wisply.ShortcutManager.html">ShortcutManager</a></li></ul><h3>Events</h3><ul><li><a href="AccountsManager.html#event:confirmDelete">confirmDelete</a></li><li><a href="Connection.html#event:FireLogoutUser">FireLogoutUser</a></li></ul><h3>Namespaces</h3><ul><li><a href="Accounts.html">Accounts</a></li><li><a href="Administration.html">Administration</a></li><li><a href="Connection.html">Connection</a></li><li><a href="FunctionalityInstitution.html">FunctionalityInstitution</a></li><li><a href="Harvest.html">Harvest</a></li><li><a href="HarvestList%25250DIt%252520holds%252520the%252520functionality%252520to%252520see%252520a%252520live%252520list%252520of%252520repositories.html">HarvestListIt holds the functionality to see a live list of repositories</a></li><li><a href="HarvestProcess.html">HarvestProcess</a></li><li><a href="Institutions.html">Institutions</a></li><li><a href="Log.html">Log</a></li><li><a href="Login.html">Login</a></li><li><a href="Operations.html">Operations</a></li><li><a href="Processes.html">Processes</a></li><li><a href="PublicRepository.html">PublicRepository</a></li><li><a href="Register.html">Register</a></li><li><a href="Repositories.html">Repositories</a></li><li><a href="TyperModule.html">TyperModule</a></li><li><a href="Websockets.html">Websockets</a></li><li><a href="WikierModule.html">WikierModule</a></li><li><a href="Wisply.html">Wisply</a></li></ul><h3>Global</h3><ul><li><a href="global.html#analyse">analyse</a></li><li><a href="global.html#changeURL">changeURL</a></li><li><a href="global.html#disableModifyURL">disableModifyURL</a></li><li><a href="global.html#enableModifyURL">enableModifyURL</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#getCounter">getCounter</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initExistingProcess">initExistingProcess</a></li><li><a href="global.html#initNewProcess">initNewProcess</a></li><li><a href="global.html#paint">paint</a></li><li><a href="global.html#perform">perform</a></li><li><a href="global.html#setCurrentCounter">setCurrentCounter</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#wisply">wisply</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Thu Oct 15 2015 13:13:25 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
